{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","emit","field","value","appEvents","data","panel","svgWrapper","highlight_text","tooltipEle","find","captionEle","theme","grafanaBootData","user","lightTheme","events","on","render","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","showError","errorText","noData","text","show","hide","addZoom","svg","select","call","d3","zoom","scale","event","transform","k","translate","x","y","attr","d","i","y_plus_5","y_minus_5","tooltipEvals","parseTooltip","tooltip","columnTexts","regExp","tooltipEval","$sanitize","match","exec","index","indexOf","replaceWith","createTooltipEvals","firstTooltip","first_term_tooltip","tooltipEvalText1","length","$interpolate","secondTooltip","second_term_tooltip","tooltipEvalText2","combineFieldIndex","combine_to_show","showWhichIndex","addNetworkChart","width","color","scaleOrdinal","color_scale","noise","remove_noise","nodes_noise","nodes_remove_noise","noiseMin","noiseMax","isNoiseRange","noiseArray","toString","split","nodeNoiseMin","nodeNoiseMax","isNodeNoiseRange","edgeNoiseArray","filter_first_link_numbers","first_filter_minumum_number_of_links","filter_second_link_numbers","second_filter_minumum_number_of_links","colorSelections","columns","map","default_index1","color_regexp1","color_data_index1","default_index2","color_regexp2","color_data_index2","selector","first_color_selector","combine_active","group","push","RegExp","first_color_regexp","second_color_selector","second_color_regexp","style","showTooltip","transition","duration","html","pageX","pageY","hideTooltip","totals","linkData","nodesData","nodesData2","doWeFilterOnEdgeCounts","sourceIndex","targetIndex","allSources","allTargets","totalsFilterHash","forEach","source","target","initHash","getGroup","setTotalsHash","combineMethod","combine_method","relations","currentRel","count","sourceFromTarget","hide_internal_relationships","param","relation1","relation2","addFirst","addSecond","id","getTotalTooltip","firstNode","secondNode","uniqBy","linkUpdate","selectAll","exit","remove","enter","append","link_thickness","dynamic_thickness","Math","log","merge","maxValueLogged","reduce","max","radius","node_radius","circleUpdate","circleEnter","clicked","drag","dragstarted","dragged","dragended","squareSide","square_side_length","rectUpdate","rectEnter","distance","link_distance","simulation","forceSimulation","force","forceLink","strength","forceManyBody","forceCenter","nodes","concat","ticked","links","captions","columnsSorted","sortBy","captionsUpdate","captionsEnter","captionsMerged","ele","creator","apply","colorTexts","columnsSortedTexts","checkHighlight","toLowerCase","alphaTarget","delay","prev_highlight_text","transformXY","active","restart","fx","fy","shiftKey","nodeName","stopPropagation","hash","key","default_index","selectorData","result","undefined","totalObj","_error","renderingCompleted"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport appEvents from 'app/core/app_events';\n\nexport default function link(scope, elem, attrs, ctrl) {\n\n  function emit(field, value) {\n    appEvents.emit('add-selection', {\n      field: field,\n      value: value\n    });\n  }\n\n\n\n  var data,panel, svgWrapper, highlight_text ;\n  var tooltipEle = elem.find('.tooltip');\n  var captionEle = elem.find('.caption');\n\n  var theme = grafanaBootData.user.lightTheme ? '-light' : '-dark' ;\n\n  elem = elem.find('.networkchart-panel');\n\n\n  ctrl.events.on('render', function() {\n    render();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n\n  function showError(errorText) {\n    var noData = elem.find(\".no-data\");\n    if(errorText){\n      noData.text(errorText);\n      noData.show();\n    }\n    else\n      noData.hide();\n  }\n\n  function addZoom(svg){\n    svgWrapper = svg.select('.svg-wrapper');\n\n    svg.call(d3.zoom().on('zoom', function() {\n\n      var scale = d3.event.transform.k,\n        translate = [d3.event.transform.x, d3.event.transform.y];\n\n      svgWrapper.attr('transform', 'translate(' + translate[0] + ', ' + translate[1] + ') scale(' + scale + ')');\n    }));\n  }\n\n\n  function y(d,i){\n    return 25 * (i+1)\n  }\n\n  function y_plus_5(d,i){\n    return y(d,i) + 5\n  }\n\n  function y_minus_5(d,i){\n    return y(d,i) - 5\n  }\n\n\n  var tooltipEvals = [];\n\n  function parseTooltip(tooltip,columnTexts){\n    var regExp=/{{(.*?)}}/g;\n    var tooltipEval = ctrl.$sanitize(tooltip);\n    var match;\n    do {\n      match = regExp.exec(tooltip);\n      if (match){\n        var index = columnTexts.indexOf(match[1]);\n        var replaceWith = index!== -1 ? `d[${index}]` : \"\";\n\n        tooltipEval = tooltipEval.replace(match[1], replaceWith)\n      }\n    } while (match);\n\n    return tooltipEval;\n  }\n\n  function createTooltipEvals(columnTexts){\n\n    var firstTooltip = panel.first_term_tooltip;\n\n    var tooltipEvalText1 = firstTooltip && columnTexts && columnTexts.length? parseTooltip(firstTooltip,columnTexts) : \"{{d[0]}}\";\n    tooltipEvals[0] = ctrl.$interpolate(tooltipEvalText1);\n\n\n    var secondTooltip = panel.second_term_tooltip;\n\n    var tooltipEvalText2 =secondTooltip && columnTexts && columnTexts.length? parseTooltip(secondTooltip,columnTexts) : \"{{d[1]}}\";\n    tooltipEvals[1] = ctrl.$interpolate(tooltipEvalText2);\n  }\n\n  function combineFieldIndex(columnTexts){\n    if(panel.combine_to_show){\n      var showWhichIndex  = columnTexts.indexOf(panel.combine_to_show);\n\n      if(showWhichIndex !== -1)\n        return showWhichIndex;\n    }\n\n    return 0;\n  }\n\n\n  function addNetworkChart() {\n    if(typeof d3 == 'undefined')\n      return;\n\n    var width = elem.width();\n    var height = elem.height();\n\n    var color = d3.scaleOrdinal(d3[panel.color_scale]);\n\n\n    var noise = panel.remove_noise ? panel.noise : 3;\n    var nodes_noise = panel.nodes_remove_noise ? panel.nodes_noise : 0;\n\n    var noiseMin = 0;\n    var noiseMax = 0;\n    var isNoiseRange = false;\n\n    var noiseArray = noise.toString().split('-');\n    if (noiseArray.length === 2) {\n      isNoiseRange = true;\n      noiseMin = noiseArray[0];\n      noiseMax = noiseArray[1];\n    }\n\n    var nodeNoiseMin = 0;\n    var nodeNoiseMax = 0;\n    var isNodeNoiseRange = false;\n\n    if (nodes_noise) {\n      var edgeNoiseArray = nodes_noise.toString().split('-');\n      if (edgeNoiseArray.length === 2) {\n        isNodeNoiseRange = true;\n        nodeNoiseMin = edgeNoiseArray[0];\n        nodeNoiseMax = edgeNoiseArray[1];\n      }\n    }\n\n\n    var filter_first_link_numbers = panel.first_filter_minumum_number_of_links ? panel.first_filter_minumum_number_of_links : 0;\n    var filter_second_link_numbers = panel.second_filter_minumum_number_of_links ? panel.second_filter_minumum_number_of_links : 0;\n\n    //************************ Init Caption and Colors Data *************************/\n    var colorSelections = {};\n    var columns = [];\n    var columnTexts = _.map(ctrl.columns,\"text\")\n\n    var default_index1;\n    var color_regexp1;\n    var color_data_index1 = null;\n\n    var default_index2;\n    var color_regexp2;\n    var color_data_index2 = null;\n\n\n    var selector = panel.first_color_selector;\n    if(selector === 'index'){\n      if(!panel.combine_active || combineFieldIndex(columnTexts) === 0)\n      {\n        default_index1= columns.length;\n\n        ctrl.columns[0].group = 0;\n        columns.push(ctrl.columns[0])\n      }\n    }\n    else if(selector === 'regular expression')\n      color_regexp1 = new RegExp(panel.first_color_regexp);\n    else\n      color_data_index1 =  columnTexts.indexOf(selector);\n\n\n    selector = panel.second_color_selector;\n    if(selector === 'index'){\n      if(!panel.combine_active || combineFieldIndex(columnTexts) === 1)\n      {\n        default_index2= columns.length;\n\n        ctrl.columns[1].group = 1;\n        columns.push(ctrl.columns[1])\n      }\n    }\n    else if(selector === 'regular expression')\n      color_regexp2 = new RegExp(panel.second_color_regexp);\n    else\n      color_data_index2 =  columnTexts.indexOf(selector);\n\n\n    //************************ Tooltips *************************/\n\n    createTooltipEvals(columnTexts);\n\n    var tooltip = d3.select(tooltipEle[0])\n      .style(\"opacity\", 0);\n\n\n    function showTooltip(d) {\n      tooltip.transition()\n        .duration(200)\n        .style(\"opacity\", .8);\n\n      tooltip.html(d.tooltip)\n        .style(\"width\",  (d.tooltip.length * 7) + \"px\")\n        .style(\"left\",  (d3.event.pageX) + \"px\")\n        .style(\"top\",   (d3.event.pageY - 28) + \"px\")\n    }\n\n\n    function hideTooltip(d) {\n      tooltip.transition()\n        .duration(500)\n        .style(\"opacity\", 0);\n    }\n\n\n    //************************ Main Graph *************************/\n\n    var svg = d3.select(elem[0]);\n\n    addZoom(svg);\n\n\n    //************************ Links between nodes *************************/\n\n    var totals = {};\n    var linkData = [];\n    var nodesData = [];\n    var nodesData2 = []; //Second group nodes\n\n    var doWeFilterOnEdgeCounts = filter_first_link_numbers || filter_second_link_numbers;\n\n    if(panel.combine_active){\n      var sourceIndex =combineFieldIndex(columnTexts);\n      var targetIndex = +!sourceIndex ; // 0 -> 1     1,2,... => 0\n\n      var allSources= {};\n      var allTargets= {};\n      var totalsFilterHash = {};\n\n\n      _.forEach(data, d => {\n\n        var value = d[d.length-1];\n        //No value\n        if (!isNoiseRange) {\n          if (!value || value < noise) {\n            return;\n          }\n        }\n        if(isNoiseRange) {\n          if (!value || value < noiseMin || value > noiseMax) {\n            return;\n          }\n        }\n        var source = d[sourceIndex];\n        var target = d[targetIndex];\n\n        initHash(allSources, source);\n        initHash(allTargets, target);\n\n        allSources[source][target] = value;\n        allTargets[target][source] = value;\n\n        allSources[source].tooltip = tooltipEvals[sourceIndex]({d: d})\n\n        if(color_data_index1 !== null || color_regexp1)\n          allSources[source].group = getGroup(d,sourceIndex);\n\n\n        if(doWeFilterOnEdgeCounts)\n        {\n          setTotalsHash(totalsFilterHash, source, value);\n          setTotalsHash(totalsFilterHash, target, value);\n        }\n      });\n\n\n\n\n\n\n      var combineMethod = _[panel.combine_method];\n\n      var relations = {};\n\n      for (var source in allSources) {\n\n        initHash(relations,source);\n        var currentRel = relations[source];\n\n        for (var target in allSources[source]) {\n          if(target === 'group' || target === 'tooltip' )\n            continue;\n\n          if(doWeFilterOnEdgeCounts && (totalsFilterHash[source].count < filter_first_link_numbers || totalsFilterHash[target].count < filter_second_link_numbers) )\n          {\n            continue;\n          }\n\n\n          var value = allSources[source][target];\n\n          for (var sourceFromTarget in allTargets[target]) {\n\n            //Already calculated at the other end\n            if(relations[sourceFromTarget]) continue;\n\n            if(panel.hide_internal_relationships && allSources[source].group === allSources[sourceFromTarget].group )\n              continue;\n\n            if(!currentRel[sourceFromTarget]) currentRel[sourceFromTarget] = 0;\n\n            var param = [value , allTargets[target][sourceFromTarget] ];\n            currentRel[sourceFromTarget] += combineMethod(param);\n          }\n        }\n      }\n\n\n\n\n      for (var relation1 in relations) {\n        for (var relation2 in relations[relation1]) {\n\n          var value = relations[relation1][relation2];\n\n          setTotalsHash(totals, relation1, value);\n          setTotalsHash(totals, relation2, value);\n        }\n      }\n\n      for (var relation1 in relations) {\n        for (var relation2 in relations[relation1]) {\n          var addFirst = totals[relation1].value > nodes_noise;\n          if(isNodeNoiseRange)\n            addFirst = totals[relation1].value > nodeNoiseMin && totals[relation1].value < nodeNoiseMax;\n\n          var addSecond = totals[relation2].value > nodes_noise;\n          if(isNodeNoiseRange)\n            addSecond = totals[relation2].value > nodeNoiseMin && totals[relation2].value < nodeNoiseMax;\n\n          if(!addFirst && !addSecond)\n            continue;\n\n          nodesData.push({\n            id: relation1 ,\n            group: allSources[relation1].group,\n            tooltip: allSources[relation1].tooltip + getTotalTooltip(relation1)\n          });\n\n          nodesData.push({\n            id: relation2 ,\n            group: allSources[relation2].group ,\n            tooltip: allSources[relation2].tooltip + getTotalTooltip(relation2)\n          });\n\n          var value = relations[relation1][relation2];\n\n          linkData.push({\n            id: relation1 + relation2,\n            source: relation1,\n            target: relation2,\n            value:  value,\n            tooltip: relation1+ ' <=> ' + relation2 + '<br>' + value\n          });\n        }\n      }\n\n\n    }\n\n    else\n    {\n      _.forEach(data, d => {\n        var value = d[d.length-1];\n\n        if (!isNoiseRange) {\n          if (!value || value < noise) {\n            return;\n          }\n        }\n        if(isNoiseRange) {\n          if (!value || value < noiseMin || value > noiseMax) {\n            return;\n          }\n        }\n\n        setTotalsHash(totals, d[0], value);\n        setTotalsHash(totals, d[1], value);\n      });\n\n\n      _.forEach(data, d => {\n        var value = d[d.length-1];\n\n        if (!isNoiseRange) {\n          if (!value || value < noise) {\n            return;\n          }\n        }\n        if(isNoiseRange) {\n          if (!value || value < noiseMin || value > noiseMax) {\n            return;\n          }\n        }\n\n\n        var  firstNode = d[0];\n        var  secondNode = d[1];\n\n        if(nodes_noise){\n          var addFirst = totals[firstNode].value > nodes_noise;\n          if(isNodeNoiseRange)\n            addFirst = totals[firstNode].value > nodeNoiseMin && totals[firstNode].value < nodeNoiseMax;\n\n          var addSecond = totals[secondNode].value > nodes_noise;\n          if(isNodeNoiseRange)\n            addSecond = totals[secondNode].value > nodeNoiseMin && totals[secondNode].value < nodeNoiseMax;\n\n\n          \n          if(!addFirst && !addSecond)\n            return;\n        }\n\n        //Should I decrement the second link number count when first is omited or vice versa\n        if(totals[firstNode].count < filter_first_link_numbers || totals[secondNode].count < filter_second_link_numbers)\n        {\n          return;\n        }\n\n\n\n        linkData.push({\n          id: firstNode + secondNode,\n          source: firstNode,\n          target: secondNode,\n          value:  value,\n          tooltip: firstNode + \" <=> \" + secondNode + \" <br> \" + value\n        });\n\n        nodesData.push({\n          id: firstNode,\n          group: getGroup(d, 0),\n          tooltip: tooltipEvals[0]({d: d}) + getTotalTooltip(firstNode)\n        }); //columns[i].text\n\n        nodesData2.push({\n          id: secondNode,\n          group: getGroup(d, 1),\n          tooltip: tooltipEvals[1]({d: d}) + getTotalTooltip(secondNode)\n        }); //columns[i].text\n      });\n\n\n    }\n\n    nodesData = _.uniqBy(nodesData, d => d.id);\n    nodesData2 = _.uniqBy(nodesData2, d => d.id);\n\n    //************************ Links d3 *************************/\n\n\n    var linkUpdate = svg.select(\".links\")\n      .selectAll(\"line\")\n      .data(linkData, d => d.id);\n\n    // EXIT\n    // Remove old elements as needed.\n    linkUpdate.exit().remove();\n\n    // ENTER\n    // Create new elements as needed.  \n    var enter = linkUpdate.enter().append(\"line\")\n      .attr(\"class\", \"line\"+theme)\n      .on(\"mouseover\", showTooltip)\n      .on(\"mouseout\", hideTooltip)\n\n    /*\n    enter    \n      .append(\"title\")\n      .text(d => d.id)\n    */\n\n    var link_thickness = panel.link_thickness;\n\n    if(panel.dynamic_thickness)\n      link_thickness = d => Math.log(d.value)\n\n    // ENTER + UPDATE\n    linkUpdate =linkUpdate.merge(enter)\n    //.selectAll(\"line\")\n      .attr(\"stroke-width\", link_thickness );\n\n\n    var maxValueLogged = _.reduce(linkData, (max, d) =>{\n      var log = Math.log(d.value);\n      if(log > max)\n        return log;\n\n      return max;\n    },0);\n\n\n    //************************ NODES d3 *************************/\n\n    //************************ Circles d3 *************************/\n\n    var radius = panel.node_radius\n\n    var circleUpdate = svg.select(\".nodes\")\n      .selectAll('circle')\n      .data(nodesData, d => d.id + '-node');\n\n    // EXIT\n    // Remove old elements as needed.\n    circleUpdate.exit().remove();\n\n    // ENTER\n    // Create new elements as needed.  \n    var circleEnter = circleUpdate.enter().append(\"circle\")\n      .on(\"mouseover\", showTooltip)\n      .on(\"mouseout\", hideTooltip)\n      .on(\"click\",clicked)\n      .call(d3.drag()\n        .on(\"start\", dragstarted)\n        .on(\"drag\", dragged)\n        .on(\"end\", dragended));\n\n\n    /*                    \n    circleEnter   \n        .append(\"title\")\n        .text(d => d.id);\n    */\n\n\n    // ENTER + UPDATE\n    circleUpdate = circleUpdate.merge(circleEnter)\n    //.selectAll(\"circle\")\n      .attr(\"r\", radius) // TODO use cummulative value for this\n      .attr(\"fill\", d => d.group ? color(d.group) : color(0) )\n\n\n    //************************ Rectangles d3 *************************/\n\n\n    var squareSide = panel.square_side_length;\n\n    var rectUpdate = svg.select(\".nodes\")\n      .selectAll('rect')\n      .data(nodesData2, d => d.id + '-node');\n\n    // EXIT\n    // Remove old elements as needed.\n    rectUpdate.exit().remove();\n\n    // ENTER\n    // Create new elements as needed.  \n    var rectEnter = rectUpdate.enter().append(\"rect\")\n      .on(\"mouseover\", showTooltip)\n      .on(\"mouseout\", hideTooltip)\n      .on(\"click\",clicked)\n      .call(d3.drag()\n        .on(\"start\", dragstarted)\n        .on(\"drag\", dragged)\n        .on(\"end\", dragended));\n\n\n    // ENTER + UPDATE\n    rectUpdate = rectUpdate.merge(rectEnter)\n      .attr(\"x\", -squareSide/2)\n      .attr(\"y\", -squareSide/2)\n      .attr(\"width\", squareSide)\n      .attr(\"height\", squareSide)\n      .attr(\"fill\", d => d.group ? color(d.group) : color(0) )\n\n\n\n    var distance = panel.link_distance || 20;\n\n    var simulation = d3.forceSimulation()\n      .force(\"link\", d3.forceLink()\n        .id(d => d.id)\n        .distance(distance)\n        .strength(d => {\n\n          if(!d.value)\n            return 0.01;\n\n          var strength = Math.log(d.value)/maxValueLogged;\n          if(strength < 0.01)\n            return 0.01;\n\n          return strength;\n        })\n      )\n      .force(\"charge\", d3.forceManyBody())\n      .force(\"center\", d3.forceCenter(width / 2, height / 2));\n\n    simulation\n      .nodes(nodesData.concat(nodesData2))\n      .on(\"tick\", ticked);\n\n    simulation.force(\"link\")\n      .links(linkData);\n\n\n    //************************ Add Caption Colors *************************/\n    var captions = d3.select(captionEle[0]);\n\n    /*\n    var columnsSorted = columns;\n    var secondColumsSorted;\n\n    if(!panel.combine_active)\n    {\n      columnsSorted = _.filter(columns, ['group', 0 ]);\n      secondColumsSorted = _.filter(columns, 'group');\n    }\n\n    columnsSorted = _.sortBy(columnsSorted,\"text\")\n\n    if(secondColumsSorted)\n      secondColumsSorted = _.sortBy(secondColumsSorted,\"text\")\n\n    */\n\n    captions.attr(\"height\", y(null,columns.length));\n\n    var columnsSorted = _.sortBy(columns, [ \"group\" , \"text\"]);\n\n    var captionsUpdate = captions.selectAll(\"g\")\n      .data(columnsSorted, (d,i) => d.text+i);\n\n    // EXIT\n    // Remove old elements as needed.\n    captionsUpdate.exit().remove();\n\n    // ENTER\n    // Create new elements as needed.  \n    var captionsEnter = captionsUpdate.enter()\n      .append(\"g\");\n\n    captionsEnter\n      .append(\"text\")\n      .attr(\"class\", \"captions-text\" + theme)\n      .attr(\"x\", 25)\n      .attr(\"y\", y_plus_5);\n\n\n    var captionsMerged = captionsUpdate.merge(captionsEnter);\n\n    captionsMerged\n      .selectAll('text')\n      .text(d => d.text);\n\n\n    if(panel.combine_active)\n      captionsMerged.append(\"circle\")\n    else\n    {\n\n      captionsMerged\n        .append(function(d){\n          var ele = d.group === 0 ? \"circle\" : \"rect\";\n          return d3.creator(ele).apply(this)\n        })\n    }\n\n\n\n    var colorTexts = _.map(columns,\"text\")\n    var columnsSortedTexts = _.map(columnsSorted,\"text\")\n\n\n    // ENTER + UPDATE\n    captionsMerged\n      .selectAll('circle')\n      .attr(\"r\", 7)\n      .attr(\"cx\", 15)\n      .attr(\"cy\", d => 25 * (columnsSortedTexts.indexOf(d.text)+1) )\n      .attr(\"fill\", d => color( colorTexts.indexOf(d.text))  )\n\n\n    captionsMerged\n      .selectAll('rect')\n      .attr(\"x\", 10 )\n      .attr(\"y\", d => 25 * (columnsSortedTexts.indexOf(d.text)+1) - 5 )\n      .attr(\"width\", 10 )\n      .attr(\"height\", 10)\n      .attr(\"fill\", d => color( colorTexts.indexOf(d.text))  )\n\n\n\n    function checkHighlight(d) {\n      return d.tooltip.toLowerCase().indexOf(highlight_text) !== -1\n    }\n\n    if(ctrl.highlight_text) {\n\n      highlight_text = ctrl.highlight_text.toLowerCase()\n\n      //stop simiulation\n      simulation.alphaTarget(0);\n\n      circleUpdate\n        .transition()\n        .duration(1000)\n        .delay(2000)\n        .attr(\"r\", d => checkHighlight(d) ? radius*7 : radius)\n        .attr(\"stroke\", d => checkHighlight(d) ? \"lightblue\" : \"\")\n        .attr(\"stroke-width\", d => checkHighlight(d) ? 2 : \"\")\n        .transition()\n        .duration(1000)\n        .delay(1000)\n        .attr(\"r\", radius)\n\n      rectUpdate\n        .transition()\n        .duration(1000)\n        .delay(2000)\n        .attr(\"width\", d => checkHighlight(d) ? squareSide*7 : squareSide)\n        .attr(\"height\", d => checkHighlight(d) ? squareSide*7 : squareSide)\n        .attr(\"stroke\", d => checkHighlight(d) ? \"lightblue\" : \"\")\n        .attr(\"stroke-width\", d => checkHighlight(d) ? 2 : \"\")\n        .transition()\n        .duration(1000)\n        .delay(1000)\n        .attr(\"width\", squareSide)\n        .attr(\"height\", squareSide)\n\n    }\n    else if(ctrl.prev_highlight_text)\n    {\n      circleUpdate\n        .attr(\"stroke\", \"\")\n        .attr(\"stroke-width\", \"\")\n\n      rectUpdate\n        .attr(\"stroke\", \"\")\n        .attr(\"stroke-width\", \"\")\n\n    }\n\n\n\n    function ticked() {\n      linkUpdate\n        .attr(\"x1\", function(d) { return d.source.x; })\n        .attr(\"y1\", function(d) { return d.source.y; })\n        .attr(\"x2\", function(d) { return d.target.x; })\n        .attr(\"y2\", function(d) { return d.target.y; });\n\n\n      function transformXY(d) {\n        return \"translate(\" + d.x + \",\" + d.y + \")\"\n      }\n\n\n      //circleUpdate.attr(\"transform\", transformXY);\n      circleUpdate\n        .attr(\"cx\", function(d) { return d.x; })\n        .attr(\"cy\", function(d) { return d.y; });\n\n      rectUpdate.attr(\"transform\", transformXY);\n    }\n\n    function dragstarted(d) {\n      if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(d) {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n    }\n\n    function clicked(d, i) {\n      if(!d3.event || !d3.event.shiftKey)\n        return;\n\n      var field;\n      if(panel.combine_active){\n        field = panel.combine_to_show;\n      }\n      else{\n        var index = this.nodeName === \"circle\" ? 0 : 1;\n\n        var field = columnTexts[index];\n      }\n\n      emit(field, d.id);\n\n      d3.event.stopPropagation();\n    }\n\n    function dragended(d) {\n      if (!d3.event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n\n    function initHash(hash,key) {\n      if (!hash[key]){\n        hash[key]= {};\n        return true;\n      }\n\n      return false;\n    }\n\n\n    function setTotalsHash(hash,key, value){\n      if(initHash(hash,key)){\n        hash[key].count = 0;\n        hash[key].value = 0;\n      }\n      hash[key].value += value;\n      hash[key].count ++;\n    }\n\n\n    function getGroup(d,index ){\n      var group;\n      var default_index = index === 0 ? default_index1 : default_index2;\n      var selector = index === 0 ? color_data_index1 : color_data_index2;\n      var regExp = index === 0 ? color_regexp1 : color_regexp2;\n\n      var selectorData ;\n\n      if(selector !== null)\n        selectorData = d[selector];\n\n      if(regExp){\n        var result =regExp.exec(d[index]);\n\n        if(result && result.length)\n          selectorData = result[result.length-1];\n      }\n\n      if(selectorData){\n        group = colorSelections[selectorData];\n        if(group === undefined)\n        {\n          group = colorSelections[selectorData] = columns.length;\n          columns.push({\n            text: selectorData,\n            group: index\n          });\n        }\n      }\n      else\n        group = default_index;\n\n      return group;\n    }\n\n\n\n    function getTotalTooltip(key){\n      var totalObj = totals[key];\n      return \"<br/> Total:\" + totalObj.value + \"&nbsp;&nbsp; Edge Count:\"  + totalObj.count;\n    }\n\n  }\n\n\n  function render() {\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (setElementHeight())\n\n      if(ctrl._error || !data || !data.length)\n      {\n\n        showError(ctrl._error || \"No data points\");\n\n        data = [];\n        addNetworkChart();\n\n      }\n      else\n      {\n        addNetworkChart();\n        showError(false);\n      }\n\n\n    ctrl.renderingCompleted();\n  }\n}\n\n"]}