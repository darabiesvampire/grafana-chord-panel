{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","emit","field","value","appEvents","data","panel","svgWrapper","highlight_text","tooltipEle","find","captionEle","theme","grafanaBootData","user","lightTheme","events","on","render","gaugeByClass","append","containerDivId","container","childNodes","setContainer","$","chordDivId","length","remove","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","showError","errorText","noData","text","show","hide","y","d","i","tooltipEvals","parseTooltip","tooltip","columnTexts","regExp","tooltipEval","$sanitize","match","exec","index","indexOf","replaceWith","getPanelWidthBySpan","trueWidth","span","panelContainer","offsetParent","clientWidth","viewPortWidth","Math","max","document","documentElement","window","innerWidth","pixelsPerSpan","round","addChordChart","matrix","mmap","checkHighlight","toLowerCase","d3","width","select","w","h","r1","r0","fill","scale","ordinal","range","chord","layout","padding","sortSubgroups","descending","sortChords","arc","svg","innerRadius","outerRadius","svgContainer","attr","rdr","Mapper","chordRdr","g","selectAll","groups","enter","mouseover","style","allTheGroups","transition","gname","each","angle","startAngle","endAngle","PI","chordPaths","chords","rgb","sname","darker","radius","html","chordTip","event","pageY","pageX","actualItem","item","itemName","tname","p","format","q","svalue","stotal","mtotal","groupTip","console","log","gvalue","connections","includes","classed","source","target","_error","mpr","chordMpr","addValuesToMap","setFilter","a","b","name","setAccessor","recs","couplingValue","getMatrix","getMap","renderingCompleted"],"mappings":";;;;;;;AAIe,WAASA,IAAT,CAAcC,KAAd,EAAqBC,IAArB,EAA2BC,KAA3B,EAAkCC,IAAlC,EAAwC;;AAErD,aAASC,IAAT,CAAcC,KAAd,EAAqBC,KAArB,EAA4B;AAC1BC,gBAAUH,IAAV,CAAe,eAAf,EAAgC;AAC9BC,eAAOA,KADuB;AAE9BC,eAAOA;AAFuB,OAAhC;AAID;;AAID,QAAIE,IAAJ,EAASC,KAAT,EAAgBC,UAAhB,EAA4BC,cAA5B;AACA,QAAIC,aAAaX,KAAKY,IAAL,CAAU,UAAV,CAAjB;AACA,QAAIC,aAAab,KAAKY,IAAL,CAAU,UAAV,CAAjB;;AAEA,QAAIE,QAAQC,gBAAgBC,IAAhB,CAAqBC,UAArB,GAAkC,QAAlC,GAA6C,OAAzD;;AAEA;;;AAGAf,SAAKgB,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAClCC;AACD,KAFD;AAGAb,WAAOL,KAAKK,IAAZ;AACAC,YAAQN,KAAKM,KAAb;;AAEA,QAAIa,eAAerB,KAAKY,IAAL,CAAU,mBAAV,CAAnB;AACA;AACAS,iBAAaC,MAAb,CAAoB,cAAYpB,KAAKqB,cAAjB,GAAgC,UAApD;AACA,QAAIC,YAAYH,aAAa,CAAb,EAAgBI,UAAhB,CAA2B,CAA3B,CAAhB;AACAvB,SAAKwB,YAAL,CAAkBF,SAAlB;AACA,QAAIG,EAAE,MAAInB,MAAMoB,UAAZ,EAAwBC,MAA5B,EAAoC;AAClCF,QAAE,MAAInB,MAAMoB,UAAZ,EAAwBE,MAAxB;AACD;;AAED,aAASC,gBAAT,GAA4B;AAC1B,UAAI;AACF,YAAIC,SAAS9B,KAAK8B,MAAL,IAAexB,MAAMwB,MAArB,IAA+B9B,KAAK+B,GAAL,CAASD,MAArD;AACA,YAAIE,EAAEC,QAAF,CAAWH,MAAX,CAAJ,EAAwB;AACtBA,mBAASI,SAASJ,OAAOK,OAAP,CAAe,IAAf,EAAqB,EAArB,CAAT,EAAmC,EAAnC,CAAT;AACD;;AAEDL,kBAAU,CAAV,CANE,CAMW;AACbA,kBAAUxB,MAAM8B,KAAN,GAAc,EAAd,GAAmB,CAA7B,CAPE,CAO8B;;AAEhCtC,aAAKuC,GAAL,CAAS,QAAT,EAAmBP,SAAS,IAA5B;;AAEA,eAAO,IAAP;AACD,OAZD,CAYE,OAAMQ,CAAN,EAAS;AAAE;AACX,eAAO,KAAP;AACD;AACF;;AAGD,aAASC,SAAT,CAAmBC,SAAnB,EAA8B;AAC5B,UAAIC,SAAS3C,KAAKY,IAAL,CAAU,UAAV,CAAb;AACA,UAAG8B,SAAH,EAAa;AACXC,eAAOC,IAAP,CAAYF,SAAZ;AACAC,eAAOE,IAAP;AACD,OAHD,MAKEF,OAAOG,IAAP;AACH;;AAGD,aAASC,CAAT,CAAWC,CAAX,EAAaC,CAAb,EAAe;AACb,aAAO,MAAMA,IAAE,CAAR,CAAP;AACD;;AAGD,QAAIC,eAAe,EAAnB;;AAEA,aAASC,YAAT,CAAsBC,OAAtB,EAA8BC,WAA9B,EAA0C;AACxC,UAAIC,SAAO,YAAX;AACA,UAAIC,cAAcrD,KAAKsD,SAAL,CAAeJ,OAAf,CAAlB;AACA,UAAIK,KAAJ;AACA,SAAG;AACDA,gBAAQH,OAAOI,IAAP,CAAYN,OAAZ,CAAR;AACA,YAAIK,KAAJ,EAAU;AACR,cAAIE,QAAQN,YAAYO,OAAZ,CAAoBH,MAAM,CAAN,CAApB,CAAZ;AACA,cAAII,cAAcF,UAAS,CAAC,CAAV,UAAmBA,KAAnB,SAA8B,EAAhD;;AAEAJ,wBAAcA,YAAYlB,OAAZ,CAAoBoB,MAAM,CAAN,CAApB,EAA8BI,WAA9B,CAAd;AACD;AACF,OARD,QAQSJ,KART;;AAUA,aAAOF,WAAP;AACD;;AAED,aAASO,mBAAT,GAA+B;AAC7B,UAAIC,YAAY,CAAhB;AACA,UAAI,OAAOvD,MAAMwD,IAAb,KAAsB,WAA1B,EAAuC;AACrC;AACAD,oBAAYvD,MAAMyD,cAAN,CAAqBC,YAArB,CAAkCC,WAA9C;AACD,OAHD,MAGO;AACL;AACA,YAAIC,gBAAgBC,KAAKC,GAAL,CAASC,SAASC,eAAT,CAAyBL,WAAlC,EAA+CM,OAAOC,UAAP,IAAqB,CAApE,CAApB;AACA;AACA,YAAIC,gBAAgBP,gBAAgB,EAApC;AACA;AACAL,oBAAYM,KAAKO,KAAL,CAAWpE,MAAMwD,IAAN,GAAaW,aAAxB,CAAZ;AACD;AACD,aAAOZ,SAAP;AACD;;AAGD,aAASc,aAAT,CAAuBC,MAAvB,EAA+BC,IAA/B,EAAqC;;AAEnC,eAASC,cAAT,CAAwBhC,CAAxB,EAA2B;AACzB,eAAO9C,KAAKQ,cAAL,IAAuBsC,EAAEiC,WAAF,GAAgBrB,OAAhB,CAAwB1D,KAAKQ,cAA7B,MAAiD,CAAC,CAAhF;AACD;;AAED,UAAG,OAAOwE,EAAP,IAAa,WAAhB,EACE;;AAEF,UAAIC,QAAQrB,qBAAZ;AACA,UAAI9B,SAAShC,KAAKgC,MAAL,EAAb;AACA;AACA;AACAkD,SAAGE,MAAH,CAAU,WAAV,EAAuBtD,MAAvB;AACA,UAAIuD,IAAIF,KAAR;AAAA,UAAeG,IAAItD,MAAnB;AAAA,UAA2BuD,KAAKD,IAAI,CAApC;AAAA,UAAuCE,KAAKD,KAAK,GAAjD;AACA,UAAIE,OAAOP,GAAGQ,KAAH,CAASC,OAAT,GACRC,KADQ,CACF,CAAC,SAAD,EAAW,SAAX,EAAqB,SAArB,EAA+B,SAA/B,EAAyC,SAAzC,EAAmD,SAAnD,EAA6D,SAA7D,EAAuE,SAAvE,EAAiF,SAAjF,EAA2F,SAA3F,EAAqG,SAArG,EAA+G,SAA/G,EAAyH,SAAzH,EAAmI,SAAnI,EAA6I,SAA7I,EAAuJ,SAAvJ,CADE,CAAX;AAEA,UAAIC,QAAQX,GAAGY,MAAH,CAAUD,KAAV,GACTE,OADS,CACD,GADC,EAETC,aAFS,CAEKd,GAAGe,UAFR,EAGTC,UAHS,CAGEhB,GAAGe,UAHL,CAAZ;AAIA,UAAIE,MAAMjB,GAAGkB,GAAH,CAAOD,GAAP,GACPE,WADO,CACKb,EADL,EAEPc,WAFO,CAEKd,KAAK,EAFV,CAAV;;AAIA,UAAIY,MAAMlB,GAAGE,MAAH,CAAU5E,MAAM+F,YAAhB,EACPjF,MADO,CACA,KADA,EAEPkF,IAFO,CAEF,OAFE,EAEOnB,CAFP,EAGPmB,IAHO,CAGF,QAHE,EAGQlB,CAHR,EAIPkB,IAJO,CAIF,OAJE,EAIO,UAJP,EAKPlF,MALO,CAKA,OALA,EAMPkF,IANO,CAMF,IANE,EAMI,QANJ,EAOPA,IAPO,CAOF,WAPE,EAOW,eAAenB,IAAI,CAAnB,GAAuB,GAAvB,GAA6BC,IAAI,CAAjC,GAAqC,GAPhD,CAAV;AAQAc,UAAI9E,MAAJ,CAAW,QAAX,EACGkF,IADH,CACQ,GADR,EACahB,KAAK,EADlB;AAEA,UAAIiB,MAAMC,OAAOC,QAAP,CAAgB7B,MAAhB,EAAwBC,IAAxB,CAAV;AACAc,YAAMf,MAAN,CAAaA,MAAb;AACA,UAAI8B,IAAIR,IAAIS,SAAJ,CAAc,SAAd,EACLtG,IADK,CACAsF,MAAMiB,MAAN,EADA,EAELC,KAFK,GAEGzF,MAFH,CAEU,OAFV,EAGLkF,IAHK,CAGA,OAHA,EAGS,OAHT,EAILrF,EAJK,CAIF,WAJE,EAIW6F,SAJX,EAKL7F,EALK,CAKF,UALE,EAKU,UAAU6B,CAAV,EAAa;AAC3BkC,WAAGE,MAAH,CAAU,UAAV,EAAsB6B,KAAtB,CAA4B,YAA5B,EAA0C,QAA1C;AACAC,qBAAaC,UAAb,GAA0BF,KAA1B,CAAgC,WAAhC,EAA6C,UAASjE,CAAT,EAAY;AAAE,iBAAOgC,eAAeyB,IAAIzD,CAAJ,EAAOoE,KAAtB,IAA+B,MAA/B,GAAwC,KAA/C;AAAuD,SAAlH;AACD,OARK,CAAR;AASAR,QAAEtF,MAAF,CAAS,UAAT,EACG2F,KADH,CACS,QADT,EACmB,OADnB,EAEGA,KAFH,CAES,MAFT,EAEiB,UAASjE,CAAT,EAAY;AAAE,eAAOyC,KAAKgB,IAAIzD,CAAJ,EAAOoE,KAAZ,CAAP;AAA4B,OAF3D,EAGGZ,IAHH,CAGQ,GAHR,EAGaL,GAHb;AAIA,UAAIe,eAAeN,EAAEtF,MAAF,CAAS,UAAT,EAChB+F,IADgB,CACX,UAASrE,CAAT,EAAY;AAAEA,UAAEsE,KAAF,GAAU,CAACtE,EAAEuE,UAAF,GAAevE,EAAEwE,QAAlB,IAA8B,CAAxC;AAA4C,OAD/C,EAEhBhB,IAFgB,CAEX,IAFW,EAEL,OAFK,EAGhBS,KAHgB,CAGV,aAHU,EAGK,8BAHL,EAIhBA,KAJgB,CAIV,WAJU,EAIG,UAASjE,CAAT,EAAY;AAAE,eAAOgC,eAAeyB,IAAIzD,CAAJ,EAAOoE,KAAtB,IAA+B,MAA/B,GAAwC,KAA/C;AAAuD,OAJxE,EAI0E;AAJ1E,OAKhBH,KALgB,CAKV,MALU,EAKF,OALE,EAMhBT,IANgB,CAMX,aANW,EAMI,UAASxD,CAAT,EAAY;AAAE,eAAOA,EAAEsE,KAAF,GAAUjD,KAAKoD,EAAf,GAAoB,KAApB,GAA4B,IAAnC;AAA0C,OAN5D,EAOhBjB,IAPgB,CAOX,WAPW,EAOE,UAASxD,CAAT,EAAY;AAC7B,eAAO,aAAaA,EAAEsE,KAAF,GAAU,GAAV,GAAgBjD,KAAKoD,EAArB,GAA0B,EAAvC,IAA6C,GAA7C,GACH,YADG,IACajC,KAAK,EADlB,IACwB,GADxB,IAEFxC,EAAEsE,KAAF,GAAUjD,KAAKoD,EAAf,GAAoB,aAApB,GAAoC,EAFlC,CAAP;AAGD,OAXgB,EAYhB7E,IAZgB,CAYX,UAASI,CAAT,EAAY;AAAE,eAAOyD,IAAIzD,CAAJ,EAAOoE,KAAd;AAAsB,OAZzB,CAAnB;AAaA,UAAIM,aAAatB,IAAIS,SAAJ,CAAc,YAAd,EACdtG,IADc,CACTsF,MAAM8B,MAAN,EADS,EAEdZ,KAFc,GAENzF,MAFM,CAEC,UAFD,EAGdkF,IAHc,CAGT,OAHS,EAGA,OAHA,EAIdS,KAJc,CAIR,QAJQ,EAIE,UAASjE,CAAT,EAAY;AAAE,eAAOkC,GAAG0C,GAAH,CAAOnC,KAAKgB,IAAIzD,CAAJ,EAAO6E,KAAZ,CAAP,EAA2BC,MAA3B,EAAP;AAA6C,OAJ7D,EAKdb,KALc,CAKR,MALQ,EAKA,UAASjE,CAAT,EAAY;AAAE,eAAOyC,KAAKgB,IAAIzD,CAAJ,EAAO6E,KAAZ,CAAP;AAA4B,OAL1C,EAMdrB,IANc,CAMT,GANS,EAMJtB,GAAGkB,GAAH,CAAOP,KAAP,GAAekC,MAAf,CAAsBvC,EAAtB,CANI,EAOdrE,EAPc,CAOX,WAPW,EAOE,UAAU6B,CAAV,EAAa;AAC5BkC,WAAGE,MAAH,CAAU,UAAV,EACG6B,KADH,CACS,YADT,EACuB,SADvB,EAEGe,IAFH,CAEQC,SAASxB,IAAIzD,CAAJ,CAAT,CAFR,EAGGiE,KAHH,CAGS,KAHT,EAGgB,YAAY;AAAE,iBAAQ/B,GAAGgD,KAAH,CAASC,KAAT,GAAiB,GAAlB,GAAuB,IAA9B;AAAmC,SAHjE,EAIGlB,KAJH,CAIS,MAJT,EAIiB,YAAY;AAAE,iBAAQ/B,GAAGgD,KAAH,CAASE,KAAT,GAAiB,GAAlB,GAAuB,IAA9B;AAAoC,SAJnE;AAKA,YAAIC,aAAa5B,IAAIzD,CAAJ,CAAjB;AACAkE,qBAAaC,UAAb,GAA0BF,KAA1B,CAAgC,WAAhC,EAA6C,UAASqB,IAAT,EAC7C;AACE,cAAIC,WAAW9B,IAAI6B,IAAJ,EAAUlB,KAAzB;AACA,iBAAOiB,WAAWG,KAAX,KAAqBD,QAArB,IAAiCF,WAAWR,KAAX,KAAqBU,QAAtD,GAAiE,MAAjE,GAA2E,KAAlF;AACD,SAJD;AAKD,OAnBc,EAoBdpH,EApBc,CAoBX,UApBW,EAoBC,YAAY;AAC1B+D,WAAGE,MAAH,CAAU,UAAV,EAAsB6B,KAAtB,CAA4B,YAA5B,EAA0C,QAA1C;AACAC,qBAAaC,UAAb,GAA0BF,KAA1B,CAAgC,WAAhC,EAA6C,UAASjE,CAAT,EAAY;AAAE,iBAAOgC,eAAeyB,IAAIzD,CAAJ,EAAOoE,KAAtB,IAA+B,MAA/B,GAAwC,KAA/C;AAAuD,SAAlH;AACD,OAvBc,CAAjB;AAwBA,eAASa,QAAT,CAAmBjF,CAAnB,EAAsB;AACpB,YAAIyF,IAAIvD,GAAGwD,MAAH,CAAU,KAAV,CAAR;AAAA,YAA0BC,IAAIzD,GAAGwD,MAAH,CAAU,MAAV,CAA9B;AACA,eAAO,qBACF1F,EAAE6E,KADA,GACQ,kBADR,GAC6B7E,EAAEwF,KAD/B,GAEH,IAFG,GAEIxF,EAAE4F,MAFN,GAEe,OAFf,GAGHH,EAAEzF,EAAE4F,MAAF,GAAS5F,EAAE6F,MAAb,CAHG,GAGoB,MAHpB,GAG6B7F,EAAE6E,KAH/B,GAGuC,YAHvC,GAGsD7E,EAAE6F,MAHxD,GAGiE,QAHjE,GAIHJ,EAAEzF,EAAE4F,MAAF,GAAS5F,EAAE8F,MAAb,CAJG,GAIoB,aAJpB,GAIoC9F,EAAE8F,MAJtC,GAI+C,QAJtD;AAKE;AACA;AACA;AACA;AACA;AACH;AACD,eAASC,QAAT,CAAmB/F,CAAnB,EAAsB;AACpBgG,gBAAQC,GAAR,CAAYjG,CAAZ;AACA,YAAIyF,IAAIvD,GAAGwD,MAAH,CAAU,KAAV,CAAR;AAAA,YAA0BC,IAAIzD,GAAGwD,MAAH,CAAU,MAAV,CAA9B;AACA,eAAO,yBACH1F,EAAEoE,KADC,GACO,KADP,GACeuB,EAAE3F,EAAEkG,MAAJ,CADf,GAC6B,OAD7B,GAEHT,EAAEzF,EAAEkG,MAAF,GAASlG,EAAE8F,MAAb,CAFG,GAEoB,aAFpB,GAEoCH,EAAE3F,EAAE8F,MAAJ,CAFpC,GAEkD,GAFzD;AAGD;AACD,eAAS9B,SAAT,CAAmBhE,CAAnB,EAAsBC,CAAtB,EAAyB;AACvB,YAAIoF,aAAa5B,IAAIzD,CAAJ,CAAjB;AACAkE,qBAAaC,UAAb,GAA0BF,KAA1B,CAAgC,WAAhC,EAA6C,UAASqB,IAAT,EAC7C;AACE,cAAIC,WAAW9B,IAAI6B,IAAJ,EAAUlB,KAAzB;AACA,iBAAOiB,WAAWc,WAAX,CAAuBC,QAAvB,CAAgCb,QAAhC,KAA6CF,WAAWjB,KAAX,KAAqBmB,QAAlE,GAA6E,MAA7E,GAAuF,KAA9F;AACD,SAJD;AAKA;AACA;AACA;AACA;AACA;AACArD,WAAGE,MAAH,CAAU,UAAV,EACG6B,KADH,CACS,YADT,EACuB,SADvB,EAEGe,IAFH,CAEQe,SAAStC,IAAIzD,CAAJ,CAAT,CAFR,EAGGiE,KAHH,CAGS,KAHT,EAGgB,YAAY;AAAE,iBAAQ/B,GAAGgD,KAAH,CAASC,KAAT,GAAiB,EAAlB,GAAsB,IAA7B;AAAkC,SAHhE,EAIGlB,KAJH,CAIS,MAJT,EAIiB,YAAY;AAAE,iBAAQ/B,GAAGgD,KAAH,CAASE,KAAT,GAAiB,GAAlB,GAAuB,IAA9B;AAAoC,SAJnE;AAKAV,mBAAW2B,OAAX,CAAmB,MAAnB,EAA2B,UAASZ,CAAT,EAAY;AACrC,iBAAOA,EAAEa,MAAF,CAAS3F,KAAT,IAAkBV,CAAlB,IACFwF,EAAEc,MAAF,CAAS5F,KAAT,IAAkBV,CADvB;AAED,SAHD;AAID;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD;;AAGD,aAAS7B,MAAT,GAAkB;AAChBb,aAAOL,KAAKK,IAAZ;AACAC,cAAQN,KAAKM,KAAb;AACA,UAAIuB,kBAAJ,EAEE,IAAG7B,KAAKsJ,MAAL,IAAe,CAACjJ,IAAhB,IAAwB,CAACA,KAAKsB,MAAjC,EACA;;AAEEY,kBAAUvC,KAAKsJ,MAAL,IAAe,gBAAzB;;AAEAjJ,eAAO,EAAP;AACAsE;AAED,OARD,MAUA;AACE,YAAI4E,MAAM/C,OAAOgD,QAAP,CAAgBnJ,IAAhB,CAAV;AACAkJ,YACGE,cADH,CACkB,QADlB,EAEGA,cAFH,CAEkB,QAFlB,EAGGC,SAHH,CAGa,UAAU3H,GAAV,EAAe4H,CAAf,EAAkBC,CAAlB,EAAqB;AAC9B,iBAAQ7H,IAAIqH,MAAJ,KAAeO,EAAEE,IAAjB,IAAyB9H,IAAIsH,MAAJ,KAAeO,EAAEC,IAA3C,IACJ9H,IAAIqH,MAAJ,KAAeQ,EAAEC,IAAjB,IAAyB9H,IAAIsH,MAAJ,KAAeM,EAAEE,IAD7C;AAED,SANH,EAOGC,WAPH,CAOe,UAAUC,IAAV,EAAgBJ,CAAhB,EAAmBC,CAAnB,EAAsB;AACjC,cAAI,CAACG,KAAK,CAAL,CAAL,EAAc,OAAO,CAAP;AACd,iBAAOA,KAAK,CAAL,EAAQX,MAAR,KAAmBO,EAAEE,IAArB,GAA4B,CAACE,KAAK,CAAL,EAAQC,aAArC,GAAqD,CAACD,KAAK,CAAL,EAAQC,aAArE;AACD,SAVH;AAWArF,sBAAc4E,IAAIU,SAAJ,EAAd,EAA+BV,IAAIW,MAAJ,EAA/B;AACA3H,kBAAU,KAAV;AACD;;AAGHvC,WAAKmK,kBAAL;AACD;AACF;;qBAjSuBvK,I;;;;AAJjBoC,O;;AACA5B,e;;AACAoG,Y","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport appEvents from 'app/core/app_events';\nimport Mapper from './mapper'\n\nexport default function link(scope, elem, attrs, ctrl) {\n\n  function emit(field, value) {\n    appEvents.emit('add-selection', {\n      field: field,\n      value: value\n    });\n  }\n\n\n\n  var data,panel, svgWrapper, highlight_text ;\n  var tooltipEle = elem.find('.tooltip');\n  var captionEle = elem.find('.caption');\n\n  var theme = grafanaBootData.user.lightTheme ? '-light' : '-dark' ;\n\n  // elem = elem.find('.networkchart-panel');\n\n\n  ctrl.events.on('render', function() {\n    render();\n  });\n  data = ctrl.data;\n  panel = ctrl.panel;\n\n  var gaugeByClass = elem.find('.grafana-d3-chord');\n  //gaugeByClass.append('<center><div id=\"'+ctrl.containerDivId+'\"></div></center>');\n  gaugeByClass.append('<div id=\"'+ctrl.containerDivId+'\"></div>');\n  var container = gaugeByClass[0].childNodes[0];\n  ctrl.setContainer(container);\n  if ($('#'+panel.chordDivId).length) {\n    $('#'+panel.chordDivId).remove();\n  }\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title ÅŸ\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n\n  function showError(errorText) {\n    var noData = elem.find(\".no-data\");\n    if(errorText){\n      noData.text(errorText);\n      noData.show();\n    }\n    else\n      noData.hide();\n  }\n\n\n  function y(d,i){\n    return 25 * (i+1)\n  }\n\n\n  var tooltipEvals = [];\n\n  function parseTooltip(tooltip,columnTexts){\n    var regExp=/{{(.*?)}}/g;\n    var tooltipEval = ctrl.$sanitize(tooltip);\n    var match;\n    do {\n      match = regExp.exec(tooltip);\n      if (match){\n        var index = columnTexts.indexOf(match[1]);\n        var replaceWith = index!== -1 ? `d[${index}]` : \"\";\n\n        tooltipEval = tooltipEval.replace(match[1], replaceWith)\n      }\n    } while (match);\n\n    return tooltipEval;\n  }\n\n  function getPanelWidthBySpan() {\n    var trueWidth = 0;\n    if (typeof panel.span === 'undefined') {\n      // get the width based on the scaled container (v5 needs this)\n      trueWidth = panel.panelContainer.offsetParent.clientWidth;\n    } else {\n      // v4 and previous used fixed spans\n      var viewPortWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n      // get the pixels of a span\n      var pixelsPerSpan = viewPortWidth / 12;\n      // multiply num spans by pixelsPerSpan\n      trueWidth = Math.round(panel.span * pixelsPerSpan);\n    }\n    return trueWidth;\n  }\n\n\n  function addChordChart(matrix, mmap) {\n\n    function checkHighlight(d) {\n      return ctrl.highlight_text && d.toLowerCase().indexOf(ctrl.highlight_text) !== -1;\n    }\n\n    if(typeof d3 == 'undefined')\n      return;\n\n    var width = getPanelWidthBySpan();\n    var height = elem.height();\n    // var color = d3.scaleOrdinal(d3[panel.color_scale]);\n    // d3.select(elem[0]).selectAll(\"*\").remove();\n    d3.select(\".d3-chord\").remove();\n    var w = width, h = height, r1 = h / 2, r0 = r1 - 110;\n    var fill = d3.scale.ordinal()\n      .range(['#7a3b2e','#a79e84','#bd5734','#454140','#f7786b','#f7cac9','#034f84','#92a8d1','#ada397','#bdcebe','#eca1a6','#d6cbd3','#ff7b25','#d64161','#feb236','#6b5b95',]);\n    var chord = d3.layout.chord()\n      .padding(.02)\n      .sortSubgroups(d3.descending)\n      .sortChords(d3.descending);\n    var arc = d3.svg.arc()\n      .innerRadius(r0)\n      .outerRadius(r0 + 20);\n\n    var svg = d3.select(panel.svgContainer)\n      .append(\"svg\")\n      .attr(\"width\", w)\n      .attr(\"height\", h)\n      .attr(\"class\", \"d3-chord\")\n      .append(\"svg:g\")\n      .attr(\"id\", \"circle\")\n      .attr(\"transform\", \"translate(\" + w / 2 + \",\" + h / 2 + \")\");\n    svg.append(\"circle\")\n      .attr(\"r\", r0 + 20);\n    var rdr = Mapper.chordRdr(matrix, mmap);\n    chord.matrix(matrix);\n    var g = svg.selectAll(\"g.group\")\n      .data(chord.groups())\n      .enter().append(\"svg:g\")\n      .attr(\"class\", \"group\")\n      .on(\"mouseover\", mouseover)\n      .on(\"mouseout\", function (d) {\n        d3.select(\"#tooltip\").style(\"visibility\", \"hidden\");\n        allTheGroups.transition().style(\"font-size\", function(d) { return checkHighlight(rdr(d).gname) ? \"15px\" : \"0px\"; });\n      });\n    g.append(\"svg:path\")\n      .style(\"stroke\", \"black\")\n      .style(\"fill\", function(d) { return fill(rdr(d).gname); })\n      .attr(\"d\", arc);\n    var allTheGroups = g.append(\"svg:text\")\n      .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })\n      .attr(\"dy\", \".35em\")\n      .style(\"font-family\", \"helvetica, arial, sans-serif\")\n      .style(\"font-size\", function(d) { return checkHighlight(rdr(d).gname) ? \"15px\" : \"0px\"; }) // remove text\n      .style(\"fill\", \"white\")\n      .attr(\"text-anchor\", function(d) { return d.angle > Math.PI ? \"end\" : null; })\n      .attr(\"transform\", function(d) {\n        return \"rotate(\" + (d.angle * 180 / Math.PI - 90) + \")\"\n          + \"translate(\" + (r0 + 26) + \")\"\n          + (d.angle > Math.PI ? \"rotate(180)\" : \"\");\n      })\n      .text(function(d) { return rdr(d).gname; });\n    var chordPaths = svg.selectAll(\"path.chord\")\n      .data(chord.chords())\n      .enter().append(\"svg:path\")\n      .attr(\"class\", \"chord\")\n      .style(\"stroke\", function(d) { return d3.rgb(fill(rdr(d).sname)).darker(); })\n      .style(\"fill\", function(d) { return fill(rdr(d).sname); })\n      .attr(\"d\", d3.svg.chord().radius(r0))\n      .on(\"mouseover\", function (d) {\n        d3.select(\"#tooltip\")\n          .style(\"visibility\", \"visible\")\n          .html(chordTip(rdr(d)))\n          .style(\"top\", function () { return (d3.event.pageY - 170)+\"px\"})\n          .style(\"left\", function () { return (d3.event.pageX - 100)+\"px\";});\n        let actualItem = rdr(d);\n        allTheGroups.transition().style(\"font-size\", function(item)\n        {\n          let itemName = rdr(item).gname;\n          return actualItem.tname === itemName || actualItem.sname === itemName ? \"15px\"  : \"0px\"\n        });\n      })\n      .on(\"mouseout\", function () {\n        d3.select(\"#tooltip\").style(\"visibility\", \"hidden\");\n        allTheGroups.transition().style(\"font-size\", function(d) { return checkHighlight(rdr(d).gname) ? \"15px\" : \"0px\"; });\n      });\n    function chordTip (d) {\n      var p = d3.format(\".1%\"), q = d3.format(\",.2f\")\n      return \"Chord Info:<br/>\"\n        +  d.sname + \"\\'s coupling to \" + d.tname\n        + \": \" + d.svalue + \"<br/>\"\n        + p(d.svalue/d.stotal) + \" of \" + d.sname + \"'s Total (\" + d.stotal + \")<br/>\"\n        + p(d.svalue/d.mtotal) + \" of Total (\" + d.mtotal + \")<br/>\"\n        // + \"<br/>\"\n        // + d.tname + \" imports from \" + d.sname\n        // + \": $\" + q(d.tvalue) + \"M<br/>\"\n        // + p(d.tvalue/d.ttotal) + \" of \" + d.tname + \"'s Total ($\" + q(d.ttotal) + \")<br/>\"\n        // + p(d.tvalue/d.mtotal) + \" of Total ($\" + q(d.mtotal) + \")\";\n    }\n    function groupTip (d) {\n      console.log(d)\n      var p = d3.format(\".1%\"), q = d3.format(\",.2f\")\n      return \"Directory Info:<br/>\"\n        + d.gname + \" : \" + q(d.gvalue) + \"<br/>\"\n        + p(d.gvalue/d.mtotal) + \" of Total (\" + q(d.mtotal) + \")\"\n    }\n    function mouseover(d, i) {\n      let actualItem = rdr(d);\n      allTheGroups.transition().style(\"font-size\", function(item)\n      {\n        let itemName = rdr(item).gname;\n        return actualItem.connections.includes(itemName) || actualItem.gname === itemName ? \"15px\"  : \"0px\"\n      });\n      // _.each(allTheGroups, (group) => {\n      //   if (group.textContent === d.textContent) {\n      //     group.transition().style(\"font-size\", \"15px\");\n      //   }\n      // });\n      d3.select(\"#tooltip\")\n        .style(\"visibility\", \"visible\")\n        .html(groupTip(rdr(d)))\n        .style(\"top\", function () { return (d3.event.pageY - 80)+\"px\"})\n        .style(\"left\", function () { return (d3.event.pageX - 130)+\"px\";})\n      chordPaths.classed(\"fade\", function(p) {\n        return p.source.index != i\n          && p.target.index != i;\n      });\n    }\n\n    // if (ctrl.highlight_text) {\n    //   g.selectAll(\"path\")\n    //     .transition()\n    //     .duration(1000)\n    //     .delay(2000)\n    //     .attr(\"d\", d => { return checkHighlight(rdr(d).gname) ? highlightedArc : arc })\n    //     .style(\"stroke\", \"black\")\n    //     .style(\"fill\", function(d) { return fill(rdr(d).gname); })\n    //     .transition()\n    //     .duration(1000)\n    //     .delay(1000)\n    //     .attr(\"d\", arc)\n    //     .style(\"stroke\", \"black\")\n    //     .style(\"fill\", function(d) { return fill(rdr(d).gname); })\n    // }\n  }\n\n\n  function render() {\n    data = ctrl.data;\n    panel = ctrl.panel;\n    if (setElementHeight())\n\n      if(ctrl._error || !data || !data.length)\n      {\n\n        showError(ctrl._error || \"No data points\");\n\n        data = [];\n        addChordChart();\n\n      }\n      else\n      {\n        var mpr = Mapper.chordMpr(data);\n        mpr\n          .addValuesToMap('source')\n          .addValuesToMap('target')\n          .setFilter(function (row, a, b) {\n            return (row.source === a.name && row.target === b.name) ||\n              (row.source === b.name && row.target === a.name)\n          })\n          .setAccessor(function (recs, a, b) {\n            if (!recs[0]) return 0;\n            return recs[0].source === a.name ? +recs[0].couplingValue : +recs[0].couplingValue;\n          });\n        addChordChart(mpr.getMatrix(), mpr.getMap());\n        showError(false);\n      }\n\n\n    ctrl.renderingCompleted();\n  }\n}\n\n"]}