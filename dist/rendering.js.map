{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","emit","field","value","appEvents","data","panel","svgWrapper","highlight_text","tooltipEle","find","captionEle","theme","grafanaBootData","user","lightTheme","events","on","render","gaugeByClass","append","containerDivId","container","childNodes","setContainer","$","chordDivId","length","remove","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","showError","errorText","noData","text","show","hide","y","d","i","tooltipEvals","parseTooltip","tooltip","columnTexts","regExp","tooltipEval","$sanitize","match","exec","index","indexOf","replaceWith","getPanelWidthBySpan","trueWidth","span","panelContainer","offsetParent","clientWidth","viewPortWidth","Math","max","document","documentElement","window","innerWidth","pixelsPerSpan","round","addChordChart","matrix","mmap","checkHighlight","toLowerCase","d3","width","select","w","h","r1","r0","fill","scale","ordinal","range","chord","layout","padding","sortSubgroups","descending","sortChords","arc","svg","innerRadius","outerRadius","highlightedArc","svgContainer","attr","rdr","Mapper","chordRdr","g","selectAll","groups","enter","mouseover","style","allTheGroups","transition","gname","allArcs","each","angle","startAngle","endAngle","PI","chordPaths","chords","rgb","sname","darker","radius","html","chordTip","event","pageY","pageX","actualItem","item","itemName","tname","p","format","q","svalue","stotal","mtotal","groupTip","gvalue","connections","includes","classed","source","target","duration","delay","_error","mpr","chordMpr","addValuesToMap","setFilter","a","b","name","setAccessor","recs","couplingValue","getMatrix","getMap","renderingCompleted"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport appEvents from 'app/core/app_events';\nimport Mapper from './mapper'\n\nexport default function link(scope, elem, attrs, ctrl) {\n\n  function emit(field, value) {\n    appEvents.emit('add-selection', {\n      field: field,\n      value: value\n    });\n  }\n\n\n\n  var data,panel, svgWrapper, highlight_text ;\n  var tooltipEle = elem.find('.tooltip');\n  var captionEle = elem.find('.caption');\n\n  var theme = grafanaBootData.user.lightTheme ? '-light' : '-dark' ;\n\n  // elem = elem.find('.networkchart-panel');\n\n\n  ctrl.events.on('render', function() {\n    render();\n  });\n  data = ctrl.data;\n  panel = ctrl.panel;\n\n  var gaugeByClass = elem.find('.grafana-d3-chord');\n  //gaugeByClass.append('<center><div id=\"'+ctrl.containerDivId+'\"></div></center>');\n  gaugeByClass.append('<div id=\"'+ctrl.containerDivId+'\"></div>');\n  var container = gaugeByClass[0].childNodes[0];\n  ctrl.setContainer(container);\n  if ($('#'+panel.chordDivId).length) {\n    $('#'+panel.chordDivId).remove();\n  }\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title ÅŸ\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n\n  function showError(errorText) {\n    var noData = elem.find(\".no-data\");\n    if(errorText){\n      noData.text(errorText);\n      noData.show();\n    }\n    else\n      noData.hide();\n  }\n\n\n  function y(d,i){\n    return 25 * (i+1)\n  }\n\n\n  var tooltipEvals = [];\n\n  function parseTooltip(tooltip,columnTexts){\n    var regExp=/{{(.*?)}}/g;\n    var tooltipEval = ctrl.$sanitize(tooltip);\n    var match;\n    do {\n      match = regExp.exec(tooltip);\n      if (match){\n        var index = columnTexts.indexOf(match[1]);\n        var replaceWith = index!== -1 ? `d[${index}]` : \"\";\n\n        tooltipEval = tooltipEval.replace(match[1], replaceWith)\n      }\n    } while (match);\n\n    return tooltipEval;\n  }\n\n  function getPanelWidthBySpan() {\n    var trueWidth = 0;\n    if (typeof panel.span === 'undefined') {\n      // get the width based on the scaled container (v5 needs this)\n      trueWidth = panel.panelContainer.offsetParent.clientWidth;\n    } else {\n      // v4 and previous used fixed spans\n      var viewPortWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n      // get the pixels of a span\n      var pixelsPerSpan = viewPortWidth / 12;\n      // multiply num spans by pixelsPerSpan\n      trueWidth = Math.round(panel.span * pixelsPerSpan);\n    }\n    return trueWidth;\n  }\n\n\n  function addChordChart(matrix, mmap) {\n\n    function checkHighlight(d) {\n      return ctrl.highlight_text && d.toLowerCase().indexOf(ctrl.highlight_text) !== -1;\n    }\n\n    if(typeof d3 == 'undefined')\n      return;\n\n    var width = getPanelWidthBySpan();\n    var height = elem.height();\n    // var color = d3.scaleOrdinal(d3[panel.color_scale]);\n    // d3.select(elem[0]).selectAll(\"*\").remove();\n    d3.select(\".d3-chord\").remove();\n    var w = width, h = height, r1 = h / 2, r0 = r1 - 110;\n    var fill = d3.scale.ordinal()\n      .range(['#eca1a6','#7a3b2e', '#d6cbd3','#454140','#ff7b25','#d64161','#feb236','#6b5b95','#bdcebe',\n        \"#023fa5\", \"#7d87b9\", \"#bec1d4\", \"#d6bcc0\",'#a79e84', \"#bb7784\", \"#8e063b\", \"#4a6fe3\", \"#8595e1\", \"#b5bbe3\",\n        \"#e6afb9\",'#f7786b', \"#e07b91\",'#ada397', \"#d33f6a\", \"#11c638\", \"#8dd593\",'#92a8d1', \"#c6dec7\", \"#ead3c6\", \"#f0b98d\", \"#ef9708\", \"#0fcfc0\",\n        \"#9cded6\", \"#d5eae7\", \"#f3e1eb\", \"#f6c4e1\",'#bd5734', \"#f79cd4\",'#034f84']);\n    var chord = d3.layout.chord()\n      .padding(.02)\n      .sortSubgroups(d3.descending)\n      .sortChords(d3.descending);\n    var arc = d3.svg.arc()\n      .innerRadius(r0)\n      .outerRadius(r0 + 20);\n    var highlightedArc = d3.svg.arc()\n      .innerRadius(r0 )\n      .outerRadius(r0 + 70);\n    var svg = d3.select(panel.svgContainer)\n      .append(\"svg\")\n      .attr(\"width\", w)\n      .attr(\"height\", h)\n      .attr(\"class\", \"d3-chord\")\n      .append(\"svg:g\")\n      .attr(\"id\", \"circle\")\n      .attr(\"transform\", \"translate(\" + w / 2 + \",\" + h / 2 + \")\");\n    svg.append(\"circle\")\n      .attr(\"r\", r0 + 20);\n    var rdr = Mapper.chordRdr(matrix, mmap);\n    chord.matrix(matrix);\n    var g = svg.selectAll(\"g.group\")\n      .data(chord.groups())\n      .enter().append(\"svg:g\")\n      .attr(\"class\", \"group\")\n      .on(\"mouseover\", mouseover)\n      .on(\"mouseout\", function (d) {\n        d3.select(\"#tooltip\").style(\"visibility\", \"hidden\");\n        allTheGroups.transition().style(\"font-size\", function(d) { return checkHighlight(rdr(d).gname) ? \"15px\" : \"0px\"; });\n      });\n    var allArcs = g.append(\"svg:path\")\n      .style(\"stroke\", \"black\")\n      .style(\"fill\", function(d) { return fill(rdr(d).gname); })\n      .attr(\"d\", arc);\n    var allTheGroups = g.append(\"svg:text\")\n      .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })\n      .attr(\"dy\", \".35em\")\n      .style(\"font-family\", \"helvetica, arial, sans-serif\")\n      .style(\"font-size\", \"0px\") // remove text\n      .style(\"fill\", \"white\")\n      .attr(\"text-anchor\", function(d) { return d.angle > Math.PI ? \"end\" : null; })\n      .attr(\"transform\", function(d) {\n        return \"rotate(\" + (d.angle * 180 / Math.PI - 90) + \")\"\n          + \"translate(\" + (r0 + 26) + \")\"\n          + (d.angle > Math.PI ? \"rotate(180)\" : \"\");\n      })\n      .text(function(d) { return rdr(d).gname; })\n    var chordPaths = svg.selectAll(\"path.chord\")\n      .data(chord.chords())\n      .enter().append(\"svg:path\")\n      .attr(\"class\", \"chord\")\n      .style(\"stroke\", function(d) { return d3.rgb(fill(rdr(d).sname)).darker(); })\n      .style(\"fill\", function(d) { return fill(rdr(d).sname); })\n      .attr(\"d\", d3.svg.chord().radius(r0))\n      .on(\"mouseover\", function (d) {\n        d3.select(\"#tooltip\")\n          .style(\"visibility\", \"visible\")\n          .html(chordTip(rdr(d)))\n          .style(\"top\", function () { return (d3.event.pageY - 170)+\"px\"})\n          .style(\"left\", function () { return (d3.event.pageX - 100)+\"px\";});\n        let actualItem = rdr(d);\n        allTheGroups.transition().style(\"font-size\", function(item)\n        {\n          let itemName = rdr(item).gname;\n          return actualItem.tname === itemName || actualItem.sname === itemName ? \"15px\"  : \"0px\"\n        });\n      })\n      .on(\"mouseout\", function () {\n        d3.select(\"#tooltip\").style(\"visibility\", \"hidden\");\n        allTheGroups.transition().style(\"font-size\", function(d) { return checkHighlight(rdr(d).gname) ? \"15px\" : \"0px\"; });\n      });\n    function chordTip (d) {\n      var p = d3.format(\".1%\"), q = d3.format(\",.2f\")\n      return \"Chord Info:<br/>\"\n        +  d.sname + \"\\'s coupling to \" + d.tname\n        + \": \" + d.svalue + \"<br/>\"\n        + p(d.svalue/d.stotal) + \" of \" + d.sname + \"'s Total (\" + d.stotal + \")<br/>\"\n        + p(d.svalue/d.mtotal) + \" of Total (\" + d.mtotal + \")<br/>\"\n        // + \"<br/>\"\n        // + d.tname + \" imports from \" + d.sname\n        // + \": $\" + q(d.tvalue) + \"M<br/>\"\n        // + p(d.tvalue/d.ttotal) + \" of \" + d.tname + \"'s Total ($\" + q(d.ttotal) + \")<br/>\"\n        // + p(d.tvalue/d.mtotal) + \" of Total ($\" + q(d.mtotal) + \")\";\n    }\n    function groupTip (d) {\n      var p = d3.format(\".1%\"), q = d3.format(\",.2f\")\n      return \"Coupling Info:<br/>\"\n        + d.gname + \" : \" + q(d.gvalue) + \"<br/>\"\n        + p(d.gvalue/d.mtotal) + \" of Total (\" + q(d.mtotal) + \")\"\n    }\n    function mouseover(d, i) {\n      let actualItem = rdr(d);\n      allTheGroups.transition().style(\"font-size\", function(item)\n      {\n        let itemName = rdr(item).gname;\n        return actualItem.connections.includes(itemName) || actualItem.gname === itemName ? \"15px\"  : \"0px\"\n      });\n      // _.each(allTheGroups, (group) => {\n      //   if (group.textContent === d.textContent) {\n      //     group.transition().style(\"font-size\", \"15px\");\n      //   }\n      // });\n      d3.select(\"#tooltip\")\n        .style(\"visibility\", \"visible\")\n        .html(groupTip(rdr(d)))\n        .style(\"top\", function () { return (d3.event.pageY - 80)+\"px\"})\n        .style(\"left\", function () { return (d3.event.pageX - 130)+\"px\";})\n      chordPaths.classed(\"fade\", function(p) {\n        return p.source.index != i\n          && p.target.index != i;\n      });\n    }\n\n    if (ctrl.highlight_text) {\n      allTheGroups.transition().style(\"font-size\", function(d) { return checkHighlight(rdr(d).gname) ? \"15px\" : \"0px\"; });\n      allArcs.transition()\n        .duration(1000)\n        .delay(2000)\n        .style(\"stroke\", \"black\")\n        .style(\"fill\", function(d) { return fill(rdr(d).gname); })\n        .attr(\"d\",   function(d)  {\n          return checkHighlight(rdr(d).gname) ? highlightedArc(d) : arc(d)\n        })\n        .transition()\n        .duration(1000)\n        .delay(10000)\n        .style(\"stroke\",  function(d) { return checkHighlight(rdr(d).gname) ? \"lightblue\" : \"black\" })\n        .attr(\"d\", arc)\n\n    }\n  }\n\n\n  function render() {\n    data = ctrl.data;\n    panel = ctrl.panel;\n    if (setElementHeight())\n\n      if(ctrl._error || !data || !data.length)\n      {\n\n        showError(ctrl._error || \"No data points\");\n\n        data = [];\n        addChordChart();\n\n      }\n      else\n      {\n        var mpr = Mapper.chordMpr(data);\n        mpr\n          .addValuesToMap('source')\n          .addValuesToMap('target')\n          .setFilter(function (row, a, b) {\n            return (row.source === a.name && row.target === b.name) ||\n              (row.source === b.name && row.target === a.name)\n          })\n          .setAccessor(function (recs, a, b) {\n            if (!recs[0]) return 0;\n            return recs[0].source === a.name ? +recs[0].couplingValue : +recs[0].couplingValue;\n          });\n        addChordChart(mpr.getMatrix(), mpr.getMap());\n        showError(false);\n      }\n\n\n    ctrl.renderingCompleted();\n  }\n}\n\n"]}