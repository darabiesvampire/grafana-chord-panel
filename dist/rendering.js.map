{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","emit","field","value","appEvents","data","panel","svgWrapper","highlight_text","tooltipEle","find","captionEle","theme","grafanaBootData","user","lightTheme","events","on","render","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","showError","errorText","noData","text","show","hide","y","d","i","tooltipEvals","parseTooltip","tooltip","columnTexts","regExp","tooltipEval","$sanitize","match","exec","index","indexOf","replaceWith","createTooltipEvals","firstTooltip","first_term_tooltip","tooltipEvalText1","length","$interpolate","secondTooltip","second_term_tooltip","tooltipEvalText2","combineFieldIndex","combine_to_show","showWhichIndex","addChordChart","matrix","mmap","d3","select","selectAll","remove","width","w","h","r1","r0","fill","scale","ordinal","range","chord","layout","padding","sortSubgroups","descending","sortChords","arc","svg","innerRadius","outerRadius","attr","append","rdr","Mapper","chordRdr","g","groups","enter","mouseover","style","gname","each","angle","startAngle","endAngle","Math","PI","chordPaths","chords","rgb","sname","darker","radius","html","chordTip","event","pageY","pageX","p","format","q","tname","svalue","stotal","mtotal","groupTip","gvalue","classed","source","target","_error","mpr","chordMpr","addValuesToMap","setFilter","a","b","name","setAccessor","recs","couplingValue","getMatrix","getMap","renderingCompleted"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport appEvents from 'app/core/app_events';\nimport Mapper from './mapper'\n\nexport default function link(scope, elem, attrs, ctrl) {\n\n  function emit(field, value) {\n    appEvents.emit('add-selection', {\n      field: field,\n      value: value\n    });\n  }\n\n\n\n  var data,panel, svgWrapper, highlight_text ;\n  var tooltipEle = elem.find('.tooltip');\n  var captionEle = elem.find('.caption');\n\n  var theme = grafanaBootData.user.lightTheme ? '-light' : '-dark' ;\n\n  elem = elem.find('.networkchart-panel');\n\n\n  ctrl.events.on('render', function() {\n    render();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n\n  function showError(errorText) {\n    var noData = elem.find(\".no-data\");\n    if(errorText){\n      noData.text(errorText);\n      noData.show();\n    }\n    else\n      noData.hide();\n  }\n\n\n  function y(d,i){\n    return 25 * (i+1)\n  }\n\n\n  var tooltipEvals = [];\n\n  function parseTooltip(tooltip,columnTexts){\n    var regExp=/{{(.*?)}}/g;\n    var tooltipEval = ctrl.$sanitize(tooltip);\n    var match;\n    do {\n      match = regExp.exec(tooltip);\n      if (match){\n        var index = columnTexts.indexOf(match[1]);\n        var replaceWith = index!== -1 ? `d[${index}]` : \"\";\n\n        tooltipEval = tooltipEval.replace(match[1], replaceWith)\n      }\n    } while (match);\n\n    return tooltipEval;\n  }\n\n  function createTooltipEvals(columnTexts){\n\n    var firstTooltip = panel.first_term_tooltip;\n\n    var tooltipEvalText1 = firstTooltip && columnTexts && columnTexts.length? parseTooltip(firstTooltip,columnTexts) : \"{{d[0]}}\";\n    tooltipEvals[0] = ctrl.$interpolate(tooltipEvalText1);\n\n\n    var secondTooltip = panel.second_term_tooltip;\n\n    var tooltipEvalText2 =secondTooltip && columnTexts && columnTexts.length? parseTooltip(secondTooltip,columnTexts) : \"{{d[1]}}\";\n    tooltipEvals[1] = ctrl.$interpolate(tooltipEvalText2);\n  }\n\n  function combineFieldIndex(columnTexts){\n    if(panel.combine_to_show){\n      var showWhichIndex  = columnTexts.indexOf(panel.combine_to_show);\n\n      if(showWhichIndex !== -1)\n        return showWhichIndex;\n    }\n\n    return 0;\n  }\n\n\n  function addChordChart(matrix, mmap) {\n    if(typeof d3 == 'undefined')\n      return;\n    d3.select(\"#circle\").selectAll(\"*\").remove();\n\n    var width = elem.width();\n    var height = elem.height();\n\n    // var color = d3.scaleOrdinal(d3[panel.color_scale]);\n\n    var w = width, h = height, r1 = h / 2, r0 = r1 - 110;\n    var fill = d3.scale.ordinal()\n      .range(['#7a3b2e','#a79e84','#bd5734','#454140','#f7786b','#f7cac9','#034f84','#92a8d1','#ada397','#bdcebe','#eca1a6','#d6cbd3','#ff7b25','#d64161','#feb236','#6b5b95',]);\n    var chord = d3.layout.chord()\n      .padding(.02)\n      .sortSubgroups(d3.descending)\n      .sortChords(d3.descending);\n    var arc = d3.svg.arc()\n      .innerRadius(r0)\n      .outerRadius(r0 + 20);\n    var svg = d3.select(elem[0])\n      .attr(\"width\", w)\n      .attr(\"height\", h)\n      .append(\"svg:g\")\n      .attr(\"id\", \"circle\")\n      .attr(\"transform\", \"translate(\" + w / 2 + \",\" + h / 2 + \")\");\n    svg.append(\"circle\")\n      .attr(\"r\", r0 + 20);\n    var rdr = Mapper.chordRdr(matrix, mmap);\n    chord.matrix(matrix);\n    var g = svg.selectAll(\"g.group\")\n      .data(chord.groups())\n      .enter().append(\"svg:g\")\n      .attr(\"class\", \"group\")\n      .on(\"mouseover\", mouseover)\n      .on(\"mouseout\", function (d) { d3.select(\"#tooltip\").style(\"visibility\", \"hidden\") });\n    g.append(\"svg:path\")\n      .style(\"stroke\", \"black\")\n      .style(\"fill\", function(d) { return fill(rdr(d).gname); })\n      .attr(\"d\", arc);\n    g.append(\"svg:text\")\n      .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })\n      .attr(\"dy\", \".35em\")\n      .style(\"font-family\", \"helvetica, arial, sans-serif\")\n      .style(\"font-size\", \"15px\")\n      .style(\"fill\", \"white\")\n      .attr(\"text-anchor\", function(d) { return d.angle > Math.PI ? \"end\" : null; })\n      .attr(\"transform\", function(d) {\n        return \"rotate(\" + (d.angle * 180 / Math.PI - 90) + \")\"\n          + \"translate(\" + (r0 + 26) + \")\"\n          + (d.angle > Math.PI ? \"rotate(180)\" : \"\");\n      })\n      .text(function(d) { return rdr(d).gname; });\n    var chordPaths = svg.selectAll(\"path.chord\")\n      .data(chord.chords())\n      .enter().append(\"svg:path\")\n      .attr(\"class\", \"chord\")\n      .style(\"stroke\", function(d) { return d3.rgb(fill(rdr(d).sname)).darker(); })\n      .style(\"fill\", function(d) { return fill(rdr(d).sname); })\n      .attr(\"d\", d3.svg.chord().radius(r0))\n      .on(\"mouseover\", function (d) {\n        d3.select(\"#tooltip\")\n          .style(\"visibility\", \"visible\")\n          .html(chordTip(rdr(d)))\n          .style(\"top\", function () { return (d3.event.pageY - 170)+\"px\"})\n          .style(\"left\", function () { return (d3.event.pageX - 100)+\"px\";})\n      })\n      .on(\"mouseout\", function (d) { d3.select(\"#tooltip\").style(\"visibility\", \"hidden\") });\n    function chordTip (d) {\n      var p = d3.format(\".1%\"), q = d3.format(\",.2f\")\n      return \"Chord Info:<br/>\"\n        +  d.sname + \"\\'s coupling to \" + d.tname\n        + \": \" + d.svalue + \"<br/>\"\n        + p(d.svalue/d.stotal) + \" of \" + d.sname + \"'s Total ($\" + d.stotal + \")<br/>\"\n        + p(d.svalue/d.mtotal) + \" of Total ($\" + d.mtotal + \")<br/>\"\n        // + \"<br/>\"\n        // + d.tname + \" imports from \" + d.sname\n        // + \": $\" + q(d.tvalue) + \"M<br/>\"\n        // + p(d.tvalue/d.ttotal) + \" of \" + d.tname + \"'s Total ($\" + q(d.ttotal) + \")<br/>\"\n        // + p(d.tvalue/d.mtotal) + \" of Total ($\" + q(d.mtotal) + \")\";\n    }\n    function groupTip (d) {\n      var p = d3.format(\".1%\"), q = d3.format(\",.2f\")\n      return \"Directory Info:<br/>\"\n        + d.gname + \" : \" + q(d.gvalue) + \"<br/>\"\n        + p(d.gvalue/d.mtotal) + \" of Total (\" + q(d.mtotal) + \")\"\n    }\n    function mouseover(d, i) {\n      d3.select(\"#tooltip\")\n        .style(\"visibility\", \"visible\")\n        .html(groupTip(rdr(d)))\n        .style(\"top\", function () { return (d3.event.pageY - 80)+\"px\"})\n        .style(\"left\", function () { return (d3.event.pageX - 130)+\"px\";})\n      chordPaths.classed(\"fade\", function(p) {\n        return p.source.index != i\n          && p.target.index != i;\n      });\n    }\n\n  }\n\n\n  function render() {\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (setElementHeight())\n\n      if(ctrl._error || !data || !data.length)\n      {\n\n        showError(ctrl._error || \"No data points\");\n\n        data = [];\n        addChordChart();\n\n      }\n      else\n      {\n          // var csvData = csvData.filter(function(d){ return d.importer1 == \"Panama\"});\n        // data = [\n        //   {\n        //     dir1: \"framework\",\n        //     dir2: \"utils\",\n        //     coupling1: 12,\n        //     coupling2: 12,\n        //   },\n        //   {\n        //     dir1: \"framework\",\n        //     dir2: \"tools\",\n        //     coupling1: 62,\n        //     coupling2: 62,\n        //   },\n        //   {\n        //     dir1: \"framework\",\n        //     dir2: \"ipojo\",\n        //     coupling1: 122,\n        //     coupling2: 122,\n        //   },\n        //   {\n        //     dir1: \"framework\",\n        //     dir2: \"test\",\n        //     coupling1: 23,\n        //     coupling2: 23,\n        //   },\n        // ];\n        var mpr = Mapper.chordMpr(data);\n        mpr\n          .addValuesToMap('source')\n          .addValuesToMap('target')\n          .setFilter(function (row, a, b) {\n            return (row.source === a.name && row.target === b.name) ||\n              (row.source === b.name && row.target === a.name)\n          })\n          .setAccessor(function (recs, a, b) {\n            if (!recs[0]) return 0;\n            return recs[0].source === a.name ? +recs[0].couplingValue : +recs[0].couplingValue;\n          });\n        addChordChart(mpr.getMatrix(), mpr.getMap());\n        showError(false);\n      }\n\n\n    ctrl.renderingCompleted();\n  }\n}\n\n"]}