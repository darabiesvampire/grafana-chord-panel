{"version":3,"sources":["../src/chord_ctrl.js"],"names":["MetricsPanelCtrl","_","rendering","ChordCtrl","$scope","$injector","$rootScope","$interpolate","$sanitize","templateSrv","detangleSrv","panelDefaults","detangle","coupling","metric","target","cohesionCalculationMethod","sourceType","targetType","sourceTypeData","targetTypeData","author","authorData","yearData","minIssuesPerFile","minIssuesData","minFilesPerIssue","minFilesData","issueTitle","issueTitleData","fileExcludeFilter","fileExcludeFilterData","metricRange","metricRangeData","fileGroup","defaults","panel","chordDivId","id","containerDivId","panelContainer","svgContainer","events","on","onDataReceived","bind","onDataError","onInitEditMode","couplingMetrics","text","value","targetSelections","cohesionCalculationMethods","addEditorTab","columnMap","columns","data","render","container","values","selectors","map","splice","concat","length","dataList","_error","type","dataConvertor","scope","elem","attrs","ctrl","templateUrl"],"mappings":"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","file":"chord_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport rendering from './rendering';\n\nexport class ChordCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, $rootScope, $interpolate, $sanitize, templateSrv, detangleSrv) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n    this.$interpolate = $interpolate;\n    this.$sanitize = $sanitize;\n    this.templateSrv = templateSrv;\n    this.detangleSrv = detangleSrv;\n    var panelDefaults = {\n      detangle: {\n        coupling: true,\n        metric: 'coupling',\n        target: 'file',\n        cohesionCalculationMethod: 'standard',\n        sourceType: '$issue_type',\n        targetType: '$target_issue_type',\n        sourceTypeData: '',\n        targetTypeData: '',\n        author: '$author',\n        authorData: '',\n        yearData: '',\n        minIssuesPerFile: null,\n        minIssuesData: '',\n        minFilesPerIssue: null,\n        minFilesData: '',\n        issueTitle: '$issue_title',\n        issueTitleData: '',\n        fileExcludeFilter: '$file_exclude',\n        fileExcludeFilterData: '',\n        metricRange: '$metric_range',\n        metricRangeData: '',\n        fileGroup: '$file_group',\n      }\n    };\n\n    _.defaults(this.panel, panelDefaults);\n    this.panel.chordDivId = 'd3chord_svg_' + this.panel.id;\n    this.containerDivId = 'container_'+this.panel.chordDivId;\n    this.panelContainer = null;\n    this.panel.svgContainer = null;\n\n    //this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n    this.couplingMetrics = [\n      {text: 'Coupling Value', value: 'coupling'},\n      {text: 'Num. of Couples', value: 'couplecounts'},\n      {text: 'Cohesion Value', value: 'cohesion'},\n\n    ];\n\n    this.targetSelections = [\n      {text: 'Issues|Committers', value: 'issue'},\n      {text: 'Files', value: 'file'},\n    ];\n\n    this.cohesionCalculationMethods = [\n      {\n        text: 'Standard', value: 'standard'\n      },\n      {\n        text: 'Double', value: 'double'\n      }\n    ];\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/grafana-chord-panel/editor.html', 2);\n  }\n\n\n  onDataError() {\n    this.columnMap = [];\n    this.columns = [];\n    this.data = [];\n    this.render();\n  }\n\n  setContainer(container) {\n    this.panelContainer = container;\n    this.panel.svgContainer = container;\n  }\n\n\n  colorSelectOptions(){\n    var values = [\"index\",\"regular expression\"];\n\n    if(!this.columns)\n      return[];\n\n    var selectors = _.map(this.columns,\"text\");\n\n    selectors.splice(-1);\n    \n    return values.concat(selectors);\n  }\n\n  combineOptions(){\n    if(!this.columns || this.columns.length < 2)\n      return[];\n\n    return [\n      this.columns[0].text ,\n      this.columns[1].text ,\n      ];\n  }\n\n\n  onDataReceived(dataList) {\n    let data = dataList[0];\n\n    if(!data)\n    {\n      this._error = \"No data points.\";\n      return this.render();\n    }\n\n    if(data.type !== \"table\")\n    {\n      this._error = \"Should be table fetch. Use terms only.\";\n      return this.render();\n    }\n\n    this._error = null;\n\n    this.columnMap = data.columnMap; \n    this.columns = data.columns;\n    this.data = this.detangleSrv.dataConvertor(dataList, this.templateSrv, this.panel.detangle, 'chord');\n    this.render(this.data);\n  }\n\n\n  link(scope, elem, attrs, ctrl) {\n    rendering(scope, elem, attrs, ctrl);\n  }\n\n\n  highlight(){\n    this.render(); \n  }\n}\n\nChordCtrl.templateUrl = 'module.html';\n"]}